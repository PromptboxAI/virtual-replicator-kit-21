import { createPublicClient, createWalletClient, http, parseEther } from 'npm:viem'
import { baseSepolia } from 'npm:viem/chains'
import { privateKeyToAccount } from 'npm:viem/accounts'

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
}

// PROMPTTEST Token contract bytecode and ABI
const PROMPTTEST_BYTECODE = "0x608060405234801561001057600080fd5b50336040518060400160405280601181526020017f50726f6d7074205465737420546f6b656e0000000000000000000000000000008152506040518060400160405280600a81526020017f50524f4d50544445535400000000000000000000000000000000000000000000815250816003908161008d91906102de565b50806004908161009d91906102de565b5050506100bc6100b161012060201b60201c565b61012860201b60201c565b6100f5336b033b2e3c9fd0803ce80000006101ee60201b60201c565b505061041e565b600033905090565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff160361025d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610254906103f5565b60405180910390fd5b61026f6000838361035b60201b60201c565b806002600082825461028191906103ef565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405161033291906103c4565b60405180910390a36103576000838361036060201b60201c565b5050565b505050565b505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806103a657607f821691505b6020821081036103b9576103b8610367565b5b50919050565b6000819050919050565b6103d2816103bf565b82525050565b60006020820190506103ed60008301846103c9565b92915050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026104557fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610418565b61045f8683610418565b95508019841693508086168417925050509392505050565b6000819050919050565b600061049c61049761049284610477565b610477565b610477565b9050919050565b6000819050919050565b6104b683610481565b6104ca6104c2826104a3565b848454610425565b825550505050565b600090565b6104df6104d2565b6104ea8184846104ad565b505050565b5b8181101561050e576105036000826104d7565b6001810190506104f0565b5050565b601f8211156105535761052481610401565b61052d84610410565b8101602085101561053c578190505b61055061054885610410565b8301826104ef565b50505b505050565b600082821c905092915050565b600061057660001984600802610558565b1980831691505092915050565b600061058f8383610565565b9150826002028217905092915050565b6105a8826103f3565b67ffffffffffffffff8111156105c1576105c06105fe565b5b6105cb825461038e565b6105d6828285610512565b600060209050601f83116001811461060957600084156105f7578287015190505b6106018582610583565b865550610669565b601f19841661061787610401565b60005b8281101561063f5784890151825560018201915060208501945060208101905061061a565b8683101561065c5784890151610658601f891682610565565b8355505b6001600288020188555050505b505050505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b60006106d6601f836106e7565b91506106e1826106a0565b602082019050919050565b600082825260208201905092915050565b6000610708826106c9565b9150819050919050565b600061071d826103bf565b915061072883610477565b925082820190508082111561074057610740610671565b5b92915050565b612a888061075560003960006000f3fe6080604052348015600f57600080fd5b506004361061011e5760003560e01c80637f8cbf47116100ad578063a9059cbb11610071578063a9059cbb1461031a578063dd62ed3e1461034a578063f2fde38b1461037a578063f5b541a614610396578063fd6b7ef8146103b45761011e565b80637f8cbf47146102545780638da5cb5b1461028457806395d89b41146102a2578063a0712d68146102c0578063a457c2d7146102ea5761011e565b80633950935111610111578063395093511461019e57806340c10f19146101ce57806370a08231146101ea578063715018a61461021a578063782d6fe1146102245761011e565b806306fdde0314610123578063095ea7b31461014157806318160ddd1461017157806323b872dd14610181575b600080fd5b61012b6103d2565b6040516101389190611c45565b60405180910390f35b61015b60048036038101906101569190611d00565b610464565b6040516101689190611d5b565b60405180910390f35b610179610487565b6040516101869190611d85565b60405180910390f35b61019b60048036038101906101969190611da0565b610491565b6040516101a89190611d5b565b60405180910390f35b6101b860048036038101906101b39190611d00565b6104c0565b6040516101c59190611d5b565b60405180910390f35b6101e860048036038101906101e39190611d00565b6104f7565b005b61020460048036038101906101ff9190611df3565b61051b565b6040516102119190611d85565b60405180910390f35b610222610563565b005b61023e60048036038101906102399190611df3565b610577565b60405161024b9190611d85565b60405180910390f35b61026e60048036038101906102699190611df3565b61058f565b60405161027b9190611d85565b60405180910390f35b61028c6105a7565b6040516102999190611e2f565b60405180910390f35b6102aa6105d1565b6040516102b79190611c45565b60405180910390f35b6102da60048036038101906102d59190611df3565b610663565b6040516102e19190611d5b565b60405180910390f35b61030460048036038101906102ff9190611d00565b61076f565b6040516103119190611d5b565b60405180910390f35b610334600480360381019061032f9190611d00565b6107e6565b6040516103419190611d5b565b60405180910390f35b610364600480360381019061035f9190611e4a565b610809565b6040516103719190611d85565b60405180910390f35b610394600480360381019061038f9190611df3565b610890565b005b61039e610913565b6040516103ab9190611d85565b60405180910390f35b6103bc61091f565b6040516103c99190611d85565b60405180910390f35b6060600380546103e190611eb9565b80601f016020809104026020016040519081016040528092919081815260200182805461040d90611eb9565b801561045a5780601f1061042f5761010080835404028352916020019161045a565b820191906000526020600020905b81548152906001019060200180831161043d57829003601f168201915b5050505050905090565b60008061046f61092b565b905061047c818585610933565b600191505092915050565b6000600254905090565b60008061049c61092b565b90506104a9858285610afc565b6104b4858585610b88565b60019150509392505050565b6000806104cb61092b565b90506104ec8185856104dd8589610809565b6104e79190611f19565b610933565b600191505092915050565b6104ff610e0c565b6105098282610e93565b5050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020549050919050565b61056b610e0c565b6105756000610ff3565b565b60066020528060005260406000206000915090505481565b60056020528060005260406000206000915090505481565b6000600560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b6060600480546105e090611eb9565b80601f016020809104026020016040519081016040528092919081815260200182805461060c90611eb9565b80156106595780601f1061062e57610100808354040283529160200191610659565b820191906000526020600020905b81548152906001019060200180831161063c57829003601f168201915b5050505050905090565b6000610e10600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054426106b39190611f19565b106106f4576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106eb90611f99565b60405180910390fd5b42600560008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610756826b033b2e3c9fd0803ce8000000610e93565b6001905091905056fe603f168201915b5050505050905090565b60008061077a61092b565b905060006107888286610809565b9050838110156107cd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107c49061202b565b60405180910390fd5b6107da8286868403610933565b60019250505092915050565b6000806107f161092b565b90506107fe818585610b88565b600191505092915050565b6000600160008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905092915050565b610898610e0c565b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610907576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108fe906120bd565b60405180910390fd5b61091081610ff3565b50565b6b033b2e3c9fd0803ce800000081565b610e1081565b600033905090565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036109a2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109999061214f565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610a11576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a08906121e1565b60405180910390fd5b80600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92583604051610aef9190611d85565b60405180910390a3505050565b6000610b088484610809565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8114610b825781811015610b74576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b6b9061224d565b60405180910390fd5b610b818484848403610933565b5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610bf7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610bee906122df565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610c66576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c5d90612371565b60405180910390fd5b610c718383836110b9565b60008060008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054905081811015610cf7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cee90612403565b60405180910390fd5b8181036000808673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610de59190611d85565b60405180910390a3610df88484846110be565b50505050565b610e046110c3565b565b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610e62576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610e5990612495565b60405180910390fd5b610e6e600083836110b9565b8060026000828254610e809190611f19565b92505081905550806000808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082825401925050819055508173ffffffffffffffffffffffffffffffffffffffff16600073ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef83604051610f319190611d85565b60405180910390a3610f45600083836110be565b5050565b610f5c6110c3565b80600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b6000600760009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905081600760006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b505050565b505050565b6110cb61092b565b73ffffffffffffffffffffffffffffffffffffffff166110e96105a7565b73ffffffffffffffffffffffffffffffffffffffff161461113f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161113690612501565b60405180910390fd5b565b600081519050919050565b600082825260208201905092915050565b60005b8381101561117b578082015181840152602081019050611160565b60008484015250505050565b6000601f19601f8301169050919050565b60006111a382611141565b6111ad818561114c565b93506111bd81856020860161115d565b6111c681611187565b840191505092915050565b600060208201905081810360008301526111eb8184611198565b905092915050565b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000611223826111f8565b9050919050565b61123381611218565b811461123e57600080fd5b50565b6000813590506112508161122a565b92915050565b6000819050919050565b61126981611256565b811461127457600080fd5b50565b60008135905061128681611260565b92915050565b600080604083850312156112a3576112a26111f3565b5b60006112b185828601611241565b92505060206112c285828601611277565b9150509250929050565b60008115159050919050565b6112e1816112cc565b82525050565b60006020820190506112fc60008301846112d8565b92915050565b61130b81611256565b82525050565b60006020820190506113266000830184611302565b92915050565b600080600060608486031215611345576113446111f3565b5b600061135386828701611241565b935050602061136486828701611241565b925050604061137586828701611277565b9150509250925092565b60006020828403121561139557611394611f3565b5b60006113a384828501611241565b91505092915050565b6113b581611218565b82525050565b60006020820190506113d060008301846113ac565b92915050565b600080604083850312156113ed576113ec6111f3565b5b60006113fb85828601611241565b925050602061140c85828601611241565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061146157607f821691505b60208210810361147457611473611416565b5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60006114b482611256565b91506114bf83611256565b92508282019050808211156114d7576114d661147a565b5b92915050565b7f46617563657420636f6f6c646f776e206e6f74206d6574000000000000000000600082015250565b600061151360178361114c565b915061151e826114dd565b602082019050919050565b6000602082019050818103600083015261154281611506565b9050919050565b7f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760008201527f207a65726f000000000000000000000000000000000000000000000000000000602082015250565b60006115a560258361114c565b91506115b082611549565b604082019050919050565b600060208201905081810360008301526115d481611598565b9050919050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b600061163760268361114c565b9150611642826115db565b604082019050919050565b600060208201905081810360008301526116668161162a565b9050919050565b7f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b60006116c960248361114c565b91506116d48261166d565b604082019050919050565b600060208201905081810360008301526116f8816116bc565b9050919050565b7f45524332303a20617070726f766520746f20746865207a65726f20616464726560008201527f7373000000000000000000000000000000000000000000000000000000000000602082015250565b600061175b60228361114c565b9150611766826116ff565b604082019050919050565b6000602082019050818103600083015261178a8161174e565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b60006117c7601d8361114c565b91506117d282611791565b602082019050919050565b600060208201905081810360008301526117f6816117ba565b9050919050565b7f45524332303a207472616e736665722066726f6d20746865207a65726f20616460008201527f6472657373000000000000000000000000000000000000000000000000000000602082015250565b600061185960258361114c565b9150611864826117fd565b604082019050919050565b600060208201905081810360008301526118888161184c565b9050919050565b7f45524332303a207472616e7366657220746f20746865207a65726f206164647260008201527f6573730000000000000000000000000000000000000000000000000000000000602082015250565b60006118eb60238361114c565b91506118f68261188f565b604082019050919050565b6000602082019050818103600083015261191a816118de565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b600061197d60268361114c565b915061198882611921565b604082019050919050565b600060208201905081810360008301526119ac81611970565b9050919050565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b60006119e9601f8361114c565b91506119f4826119b3565b602082019050919050565b60006020820190508181036000830152611a18816119dc565b9050919050565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b6000611a5560208361114c565b9150611a6082611a1f565b602082019050919050565b60006020820190508181036000830152611a8481611a48565b9050919050565b6000819050919050565b6000611ab0611aab611aa6846111f8565b611a8b565b6111f8565b9050919050565b6000611ac282611a95565b9050919050565b6000611ad482611ab7565b9050919050565b611ae481611ac9565b82525050565b6000602082019050611aff6000830184611adb565b92915050565b7f45524332303a20616c6c6f77616e63652062656c6f77207a65726f0000000000600082015250565b6000611b3b601b8361114c565b9150611b4682611b05565b602082019050919050565b60006020820190508181036000830152611b6a81611b2e565b9050919050565b7f45524332303a20696e73756666696369656e742062616c616e636520666f722060008201527f6661756365740000000000000000000000000000000000000000000000000000602082015250565b6000611bcd60268361114c565b9150611bd882611b71565b604082019050919050565b60006020820190508181036000830152611bfc81611bc0565b9050919050565b7f45524332303a20696e76616c6964207370656e646572000000000000000000600082015250565b6000611c3960168361114c565b9150611c4482611c03565b602082019050919050565b60006020820190508181036000830152611c6881611c2c565b9050919050565b7f45524332303a20696e76616c6964207265636569766572000000000000000000600082015250565b6000611ca560178361114c565b9150611cb082611c6f565b602082019050919050565b60006020820190508181036000830152611cd481611c98565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000611d11601d8361114c565b9150611d1c82611cdb565b602082019050919050565b60006020820190508181036000830152611d4081611d04565b9050919050565b7f45524332303a206d696e7420746f20746865207a65726f206164647265737300600082015250565b6000611d7d601f8361114c565b9150611d8882611d47565b602082019050919050565b60006020820190508181036000830152611dac81611d70565b9050919050565b7f45524332303a206275726e2066726f6d20746865207a65726f2061646472657360008201527f7300000000000000000000000000000000000000000000000000000000000000602082015250565b6000611e0f60218361114c565b9150611e1a82611db3565b604082019050919050565b60006020820190508181036000830152611e3e81611e02565b9050919050565b7f45524332303a206275726e20616d6f756e7420657863656564732062616c616e60008201527f6365000000000000000000000000000000000000000000000000000000000000602082015250565b6000611ea160228361114c565b9150611eac82611e45565b604082019050919050565b60006020820190508181036000830152611ed081611e94565b9050919050565b7f45524332303a206275726e2066726f6d20746865207a65726f2061646472657360008201527f7300000000000000000000000000000000000000000000000000000000000000602082015250565b6000611f3360218361114c565b9150611f3e82611ed7565b604082019050919050565b60006020820190508181036000830152611f6281611f26565b9050919050565b7f45524332303a206275726e20616d6f756e7420657863656564732062616c616e60008201527f6365000000000000000000000000000000000000000000000000000000000000602082015250565b6000611fc560228361114c565b9150611fd082611f69565b604082019050919050565b60006020820190508181036000830152611ff481611fb8565b9050919050565b7f45524332303a20696e73756666696369656e7420616c6c6f77616e6365000000600082015250565b6000612031601d8361114c565b915061203c82611ffb565b602082019050919050565b6000602082019050818103600083015261206081612024565b9050919050565b7f45524332303a207472616e7366657220616d6f756e742065786365656473206260008201527f616c616e63650000000000000000000000000000000000000000000000000000602082015250565b60006120c360268361114c565b91506120ce82612067565b604082019050919050565b600060208201905081810360008301526120f2816120b6565b905091905056fea2646970667358221220a4b4a0c2d0c2e5c8b6f7b6e5a4c4f3e0a7b5e1c1b4d2f6e1b9b5c5c6c9b6b6c364736f6c63430008140033"

const PROMPTTEST_ABI = [
  {
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "inputs": [],
    "name": "faucet",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "to",
        "type": "address"
      },
      {
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      }
    ],
    "name": "mint",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "FAUCET_AMOUNT",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "FAUCET_COOLDOWN",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "name": "lastFaucetClaim",
    "outputs": [
      {
        "internalType": "uint256",
        "name": "",
        "type": "uint256"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  }
]

Deno.serve(async (req) => {
  // Handle CORS preflight requests
  if (req.method === 'OPTIONS') {
    return new Response(null, { headers: corsHeaders });
  }

  try {
    const deployerPrivateKey = Deno.env.get('DEPLOYER_PRIVATE_KEY');
    if (!deployerPrivateKey) {
      throw new Error('DEPLOYER_PRIVATE_KEY not found');
    }

    console.log('Deploying PROMPTTEST token...');

    // Create clients
    const publicClient = createPublicClient({
      chain: baseSepolia,
      transport: http()
    });

    const account = privateKeyToAccount(deployerPrivateKey as `0x${string}`);
    const walletClient = createWalletClient({
      account,
      chain: baseSepolia,
      transport: http()
    });

    console.log('Deploying from address:', account.address);
    console.log('Bytecode length:', PROMPTTEST_BYTECODE.length);
    console.log('Bytecode starts with 0x:', PROMPTTEST_BYTECODE.startsWith('0x'));

    // Deploy PROMPTTEST contract
    const hash = await walletClient.deployContract({
      abi: PROMPTTEST_ABI,
      bytecode: PROMPTTEST_BYTECODE as `0x${string}`,
      args: []
    });

    console.log('Transaction hash:', hash);

    // Wait for transaction receipt
    const receipt = await publicClient.waitForTransactionReceipt({ hash });
    console.log('Contract deployed at:', receipt.contractAddress);

    return new Response(JSON.stringify({
      success: true,
      contractAddress: receipt.contractAddress,
      transactionHash: hash,
      blockNumber: receipt.blockNumber
    }), {
      headers: { ...corsHeaders, 'Content-Type': 'application/json' },
      status: 200
    });

  } catch (error) {
    console.error('Error deploying PROMPTTEST:', error);
    
    return new Response(JSON.stringify({
      success: false,
      error: error.message
    }), {
      headers: { ...corsHeaders, 'Content-Type': 'application/json' },
      status: 500
    });
  }
});